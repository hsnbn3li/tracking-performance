<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>تتبع أداء الفريق — مشاركة واتساب</title>
<style>
:root{
  --bg:#ffffff;
  --card:#f8fafc;
  --accent:#0b9f6b;
  --muted:#475569;
  --border:#e6eef6;
  --success-bg: #ecfdf5;
  --success-border: #bbf7d0;
}
body{
  margin:0;font-family:"Segoe UI", Tahoma, Arial, "Noto Naskh Arabic", system-ui;
  background: var(--bg); color:#0b1220; direction:rtl; padding:18px;
}
.container{max-width:980px;margin:0 auto}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:12px}
label{display:block;margin-bottom:6px;color:var(--muted);font-weight:700}
.top-row input[type="date"], .top-row input[type="number"]{
  width:100%; padding:12px 14px; border-radius:10px; border:1px solid #e2e8f0; background:#fff; color:inherit;
  box-sizing:border-box; font-size:16px; font-weight:700;
}
.service-row{display:flex;gap:8px;align-items:center;padding:8px;border-radius:10px;border:1px solid rgba(2,6,23,0.03);margin-bottom:8px;background:#fff}
.service-label{font-weight:800;min-width:160px}
.count-badge{background:#0b9f6b;color:#fff;padding:6px 10px;border-radius:999px;font-weight:800;margin-left:8px}
.entries{display:flex;gap:6px;flex-wrap:wrap;flex:1}
.entry-chip{background:#fff;padding:6px 8px;border-radius:8px;border:1px solid var(--border)}
.actions{display:flex;gap:8px;margin-top:12px}
.btn{padding:10px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:800;font-size:15px}
.btn.primary{background:#0b9f6b;color:#fff}
.btn.ghost{background:transparent;border:1px solid rgba(2,6,23,0.06)}
.preview{white-space:pre-wrap;background:#fff;padding:12px;border-radius:8px;border:1px solid var(--border);margin-top:8px;font-family:inherit;font-size:15px}
.shift-card{border-radius:10px;padding:10px;border:1px solid var(--border);background:linear-gradient(180deg,#ffffff,#fbfdff);margin-bottom:12px}
.shift-card.success{background:var(--success-bg);border-color:var(--success-border)}
.shift-title{font-weight:900;display:flex;align-items:center;gap:8px}
.shift-trophy{font-size:18px}
hr{border:none;border-top:1px solid #e6eef6;margin:12px 0}
</style>
</head>
<body>
<div class="container">
<div class="card">
<h2>تتبع الأداء</h2>
<div class="top-row" style="display:flex;gap:12px;flex-wrap:wrap;margin-top:8px">
<div style="flex:1;min-width:180px">
<label>التاريخ</label>
<input id="date" type="date" />
</div>
<div style="flex:1;min-width:160px">
<label>المستهدف (ريال)</label>
<input id="targetInput" type="number" value="586" />
</div>
</div>
<div class="actions" style="margin-top:12px">
<button class="btn primary" id="fillDemo">ملء مثال</button>
<button class="btn ghost" id="clearAll">مسح</button>
</div>
</div>

<div id="morningCard" class="card shift-card">
<div class="shift-title" id="morningTitle"><h3 style="margin:0">المحاكاة الصباحية</h3><span id="morningTrophy" class="shift-trophy" style="display:none">🏆</span></div>
<div id="morningServices"></div>
<div style="margin-top:8px;font-weight:800">المحقق: <span id="morningTotal">0</span> ر.س <span id="morningTrophyTotal" style="display:none">🏆</span></div>
</div>

<hr>

<div id="eveningCard" class="card shift-card">
<div class="shift-title" id="eveningTitle"><h3 style="margin:0">المحاكاة المسائية</h3><span id="eveningTrophy" class="shift-trophy" style="display:none">🏆</span></div>
<div id="eveningServices"></div>
<div style="margin-top:8px;font-weight:800">المحقق: <span id="eveningTotal">0</span> ر.س <span id="eveningTrophyTotal" style="display:none">🏆</span></div>
</div>

<div class="card">
<div style="font-weight:900">الإجمالي الكلي: <span id="grandTotal">0</span> ر.س</div>
<div class="actions" style="margin-top:12px">
<button class="btn primary" id="shareBtn">مشاركة على واتساب</button>
<button class="btn ghost" id="copyBtn">نسخ النص</button>
</div>
<div style="margin-top:12px;font-weight:800">معاينة الرسالة:</div>
<div class="preview" id="messagePreview">— لا توجد بيانات —</div>
</div>
</div>

<script>
const SERVICES = ["بلس دولي","بلس داخلي","الشحن الدولي","الشحن الداخلي","اسميز","عنونة","حماية","كرتون","تغليف","شد وربط"];
const SPECIAL_FIRE_EMOJI_SERVICES = ["اسميز","بلس دولي"];
const state={morning:{},evening:{},target:586};
SERVICES.forEach(s=>{state.morning[s]=[];state.evening[s]=[];});
function toEnglishNumbers(str){return str.replace(/[٠-٩۰-۹]/g,d=>String.fromCharCode(d.charCodeAt(0)<=1776?48+d.charCodeAt(0)-1632:48+d.charCodeAt(0)-1776));}
function createServiceRows(container,shiftKey){container.innerHTML="";SERVICES.forEach(s=>{const row=document.createElement("div");row.className="service-row";const label=document.createElement("div");label.className="service-label";label.textContent=s;const badge=document.createElement("span");badge.className="count-badge";badge.textContent="0";label.appendChild(badge);const entries=document.createElement("div");entries.className="entries";const addBtn=document.createElement("button");addBtn.className="btn primary";addBtn.textContent="إضافة";addBtn.addEventListener("click",()=>{const v=prompt("أدخل مبلغ (ريال) لـ "+s);if(v===null)return;const n=Number(toEnglishNumbers(v));if(isNaN(n)||n<=0){alert("أدخل رقم صحيح أكبر من صفر");return;}state[shiftKey][s].push(n);renderAll();});const clearBtn=document.createElement("button");clearBtn.className="btn ghost";clearBtn.textContent="مسح الكل";clearBtn.addEventListener("click",()=>{if(confirm("مسح جميع الإدخالات؟")){state[shiftKey][s]=[];renderAll();}});const actions=document.createElement("div");actions.style.display="flex";actions.style.gap="6px";actions.appendChild(addBtn);actions.appendChild(clearBtn);row.appendChild(label);row.appendChild(entries);row.appendChild(actions);row._service=s;row._badge=badge;row._entries=entries;container.appendChild(row);});}
function sumEntries(obj){return Object.values(obj).flat().reduce((a,b)=>a+b,0)||0;}
function toggleSuccess(shift,sum,target){const card=document.getElementById(shift+"Card");const titleTrophy=document.getElementById(shift+"Trophy");const trophyTotal=document.getElementById(shift+"TrophyTotal");if(sum>target){card.classList.add("success");titleTrophy.style.display="inline";trophyTotal.style.display="inline";}else{card.classList.remove("success");titleTrophy.style.display="none";trophyTotal.style.display="none";}}
function buildMessagePreview(){
const dateInput=document.getElementById("date").value;
let dateStr="";
if(dateInput){const d=new Date(dateInput);const dd=("0"+d.getDate()).slice(-2);const mm=("0"+(d.getMonth()+1)).slice(-2);const yyyy=d.getFullYear();dateStr=dd+"/"+mm+"/"+yyyy;}else{const d=new Date();const dd=("0"+d.getDate()).slice(-2);const mm=("0"+(d.getMonth()+1)).slice(-2);const yyyy=d.getFullYear();dateStr=dd+"/"+mm+"/"+yyyy;}
const target=Number(document.getElementById("targetInput").value||586);
let lines=[];
lines.push("*يوم جديد وتحدي جديد* 💪");
lines.push(dateStr);
lines.push("");
["morning","evening"].forEach(shift=>{
lines.push(shift==="morning"?"*الصباحية:*":"*المسائية:*"+(sumEntries(state[shift])>target?" 🏆":""));
SERVICES.forEach(s=>{const arr=state[shift][s]||[];const count=arr.length;const sum=arr.reduce((a,b)=>a+b,0)||0;if(count>0){const fire=SPECIAL_FIRE_EMOJI_SERVICES.includes(s)?" 🔥":"";lines.push(`${s} ✅ ${sum}${fire}`);}else lines.push(`${s} ❌`);});
lines.push("___");
lines.push(`المستهدف: ${target}`);
lines.push(`المحقق: ${sumEntries(state[shift])}${sumEntries(state[shift])>target?" 🏆":""}`);
lines.push("");
});
lines.push("___");
lines.push(`الإجمالي الكلي: ${sumEntries(state.morning)+sumEntries(state.evening)}`);
const message=lines.join("\n");
document.getElementById("messagePreview").textContent=message;
return message;
}
function renderAll(){
["morning","evening"].forEach(shift=>{const rows=document.querySelectorAll(`#${shift}Services .service-row`);rows.forEach(row=>{const s=row._service,arr=state[shift][s]||[];row._entries.innerHTML="";arr.forEach((v,i)=>{const chip=document.createElement("div");chip.className="entry-chip";chip.textContent=v.toLocaleString('ar-EG')+" ر.س";const remove=document.createElement("small");remove.textContent=" ✖";remove.style.marginLeft="6px";remove.style.cursor="pointer";remove.addEventListener("click",()=>{state[shift][s].splice(i,1);renderAll();});chip.appendChild(remove);row._entries.appendChild(chip);});row._badge.textContent=arr.length;});});
const mSum=sumEntries(state.morning);const eSum=sumEntries(state.evening);
document.getElementById("morningTotal").textContent=mSum.toLocaleString('ar-EG');
document.getElementById("eveningTotal").textContent=eSum.toLocaleString('ar-EG');
document.getElementById("grandTotal").textContent=(mSum+eSum).toLocaleString('ar-EG')+" ر.س";
const target=Number(document.getElementById("targetInput").value||586);
toggleSuccess("morning",mSum,target);
toggleSuccess("evening",eSum,target);
buildMessagePreview();
}
function shareOnWhatsApp(){const text=buildMessagePreview();const url="https://api.whatsapp.com/send?text="+encodeURIComponent(text);window.open(url,"_blank");}
function copyText(){navigator.clipboard.writeText(buildMessagePreview()).then(()=>{alert("نُسخ النص ✅");}).catch(()=>alert("فشل النسخ"));}
document.getElementById("shareBtn").addEventListener("click",shareOnWhatsApp);
document.getElementById("copyBtn").addEventListener("click",copyText);
document.getElementById("fillDemo").addEventListener("click",()=>{SERVICES.forEach((s,i)=>{state.morning[s]=(i%2===0)?[300,50]:[];state.evening[s]=(i%3===0)?[200]:[];});document.getElementById("date").value=new Date().toISOString().slice(0,10);document.getElementById("targetInput").value=586;renderAll();});
document.getElementById("clearAll").addEventListener("click",()=>{SERVICES.forEach(s=>{state.morning[s]=[];state.evening[s]=[];});document.getElementById("date").value="";document.getElementById("targetInput").value=586;renderAll();});

createServiceRows(document.getElementById("morningServices"),"morning");
createServiceRows(document.getElementById("eveningServices"),"evening");
document.getElementById("date").value=new Date().toISOString().slice(0,10);
document.getElementById("targetInput").value=586;
renderAll();
</script>
</body>
</html>
